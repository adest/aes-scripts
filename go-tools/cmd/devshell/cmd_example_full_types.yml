# ─── TYPE DEFINITIONS ────────────────────────────────────────────────────────
# Types are reusable templates referenced via `uses`.
# A param declared as `~` (null) is required; a scalar value sets a default.

types:

  # ── Simple runnable type ──────────────────────────────────────────────────
  # Demonstrates: required param, optional param with default, template substitution.
  greeter:
    name: "greet-{{ .name }}"  # fallback child name in multi-type expansion
    params:
      name: ~            # required — caller must supply a value
      greeting: hello    # optional — defaults to "hello"
    command: echo {{ .greeting }} {{ .name }}

  # ── Container type ────────────────────────────────────────────────────────
  # Demonstrates: type that expands into multiple named children.
  lifecycle:
    name: "lifecycle-{{ .subject }}"  # fallback child name in multi-type expansion
    params:
      subject: ~
    children:
      - name: start
        command: echo starting {{ .subject }}
      - name: stop
        command: echo stopped {{ .subject }}

  # ── Pipeline type ─────────────────────────────────────────────────────────
  # Demonstrates: type that expands into a pipeline with capture and injection.
  list-and-count:
    params:
      path: /tmp
    steps:
      - id: listing
        command: ls
        args:
          - "{{ .path }}"
        capture: stdout
        tee: true          # stream to terminal AND buffer for later steps
      - command: echo
        args:
          - "done listing {{ .path }}"

  # ── Nested type ───────────────────────────────────────────────────────────
  # Demonstrates: a type whose body itself uses other types (recursive expansion).
  double-greet:
    params:
      first: ~
      second: ~
    children:
      - name: greet-first
        uses: greeter
        with:
          name: "{{ .first }}"
      - name: greet-second
        uses: greeter
        with:
          name: "{{ .second }}"
          greeting: hey
