# ─── TYPE DEFINITIONS ────────────────────────────────────────────────────────
# Types are reusable templates referenced via `uses`.
# A param declared as `~` (null) is required; a scalar value sets a default.

types:

  # ── Simple runnable type ──────────────────────────────────────────────────
  # Demonstrates: required param, optional param with default, template substitution.
  greeter:
    name: "greet-{{ params.name }}"  # fallback child name in multi-type expansion
    params:
      name: ~            # required — caller must supply a value
      greeting: hello    # optional — defaults to "hello"
    command: echo {{ params.greeting }} {{ params.name }}

  # ── Container type ────────────────────────────────────────────────────────
  # Demonstrates: type that expands into multiple named children.
  lifecycle:
    name: "lifecycle-{{ params.subject }}"  # fallback child name in multi-type expansion
    params:
      subject: ~
    children:
      - name: start
        command: echo starting {{ params.subject }}
      - name: stop
        command: echo stopped {{ params.subject }}

  # ── Pipeline type ─────────────────────────────────────────────────────────
  # Demonstrates: type that expands into a pipeline with capture and injection.
  list-and-count:
    params:
      path: /tmp
    steps:
      - id: listing
        command: ls
        args:
          - "{{ params.path }}"
        capture: stdout
        tee: true          # stream to terminal AND buffer for later steps
      - command: echo
        args:
          - "done listing {{ params.path }}"

  # ── Nested type ───────────────────────────────────────────────────────────
  # Demonstrates: a type whose body itself uses other types (recursive expansion).
  double-greet:
    params:
      first: ~
      second: ~
    children:
      - name: greet-first
        uses: greeter
        with:
          name: "{{ params.first }}"
      - name: greet-second
        uses: greeter
        with:
          name: "{{ params.second }}"
          greeting: hey

  # ── Type with runtime inputs ───────────────────────────────────────────────
  # `params` are resolved at expansion time; `inputs` are collected at runtime.
  # A type that declares `inputs` propagates them to the concrete node produced
  # by expansion: {{ inputs.name }} is preserved as a literal until execution.
  deploy:
    params:
      env: prod        # resolved at expansion time (via `with`)
    inputs:
      version: ~       # required runtime input — prompted or passed as key=value
      tag: latest      # optional runtime input with default
    command: echo deploying {{ inputs.version }}:{{ inputs.tag }} to {{ params.env }}
